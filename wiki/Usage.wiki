#summary How to run and configure spectrawl

= Usage =

== In a nutshell == 
With spectrawl you can explore peak mass differences (`Δm`) in MS2 spectra. All mass differences between all peaks of a given spectrum (an optional noise filtering step can be performed first) are computed and put into a frequency diagram. The size of the bins and the lower and upper boundaries are user definable. To look for specific mass differences and/or M/Z ratios, several [Usage#Filters filters] are provided. Spectrawl supports import from [http://code.google.com/p/ms-lims ms_lims] and from spectra in MGF format.

== Configuration ==
The configuration file can be found in the _resources_ folder. These file can be edited by the user if necessary. If no files are found in the _resources_ directory, default values will be used instead. 

=== spectrawl.properties ===
Most of the parameter values in this file should be left to their default values. The settings that the user might need the change are listed below
  * `db.driver`: the database driver class name to connect to a ms_lims datatabase.
  * `db.url`: the url of a ms_lims database.
  * `db.username`: the database user name.
  * `db.password`: the database password.
  * `size`: the size of the task executor; how many threads you want to run in parallel.
  * `BINS_FLOOR`: the lowest `Δm` value you're interested in.
  * `BINS_CEILING`: the highest `Δm` value you're interested in.
  * `BINS_SIZE`: the size of a bin (in dalton).
  * `DO_PROCESS_FILTER`: do the spectra have to go through a noise filtering step (winsorization) before analyzing the mass differences between peaks.

== Running ==
Run spectrawl by double clicking the .jar file in the spectrawl-x.y.z folder. First, it will try to connect to the database. If no connection with a ms_lims database could be achieved, a warning message is shown and only MGF input will be supported.

It is possible that you need more than the default memory to run spectrawl. In case of any memory issues, open a command line window and execute the following command in the `spectrawl-x.y.z` folder where the _.jar_ file is located:
{{{
java -jar spectrawl-<version>.jar -Xms4g -Xmx4g
}}}
and adjust the memory (4 gigabyte in this case) accordingly.

Once spectrawl is up and running, you can select a ms_lims experiment or a MGF file(s), apply some [Usage#Filters filters] and let it spin. 

== Filters ==
Filters can be configured in the _Filter_ menu. If several filters are applied at the same time, they will be executed sequentially. Some of the filters have a _Filter type_ with 2 options:
  * _and_: all values in the filter need to be there in order to pass.
  * _or_: one of values in the filter need to there in order to pass.
You can disable a filter by emptying all the values and fields.
=== Noise filtering ===
As mentioned before, some optional noise filtering is applied on the spectra. You can enable or disable this in the properties file or in the _Filter_ -> _M/Z ratio_ -> _Noise filter settings_ tab. 

=== Mass delta ===
This type of filters require an intensity threshold value. The 'intensity' of a `Δm` is calculated as the square root of the normalized intensities of the two peaks. The mass delta filters look for if a given `Δm` is present in a spectrum, and if its intensity is higher than the threshold value. As a guideline, start with using values between 0.01
 
==== Basic filter ====
_Filter_ -> _Mass delta_: add one or more mass delta values a spectrum needs to contain to pass the filter.
 
==== Advanced filters ====
_Filter_ -> _Mass delta_: there are two types of advanced `Δm` filters. 
  * Fixed comb `Δm` filter: this filter looks for a consecutive `Δm` values within a spectrum between the given minimum and maximum. The consecutive `Δm` is one value. 
  * Variable comb `Δm` filter: this filter looks for a set a given consecutive `Δm` values in a spectrum. 

=== M/Z ratio ===
This type of filters look for specific M/Z values, not mass differences between peaks. They can be configured in _Filter_ -> _M/Z ratio_ and require a mass tolerance. 
 
==== M/Z ratio filter ====
This filter looks for given M/Z ratios in spectra.

==== Precursor relative mass filter ====
This filter looks for given mass values relative to the precursor value. A negative value is subtracted from the precursor, a positive value is added.

== Output ==
When spectrawl has finished processing, the initial number of spectra and the number that have passed the filter(s) are shown. The intensities chart shows the 50% quantiles of the highest intensity and the intensity sum in each bin, across all (filtered) spectra. You can browse through the spectra in the _spectra_ tab (click above one peak and then above another the calculate the `Δm`, do _ctrl_ + mouse click to undo). 